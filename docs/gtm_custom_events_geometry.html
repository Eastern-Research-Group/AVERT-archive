<script>
  (function() {
    var regionSelect = document.querySelector('[data-avert-region-select]');
    var stateSelect = document.querySelector('[data-avert-state-select]');
    var regionMap = document.querySelector('[data-avert-region-map]');
    var stateMap = document.querySelector('[data-avert-state-map]');

    if (!regionSelect || !stateSelect || !regionMap || !stateMap) return;

    /**
     * @param {'region'|'state'} geography
     * @param {HTMLSelectElement} selectEl
    */
    function captureSelectedGeography(geography, selectEl) {
      if (geography === 'region') {
        window.dataLayer.push({
          event: 'regionSelected',
          selectedRegion: selectEl.options[selectEl.selectedIndex].value,
          selectedState: undefined,
          clickedRegion: undefined,
          clickedState: undefined,
        });
      }

      if (geography === 'state') {
        window.dataLayer.push({
          event: 'stateSelected',
          selectedRegion: undefined,
          selectedState: selectEl.options[selectEl.selectedIndex].value,
          clickedRegion: undefined,
          clickedState: undefined,
        });
      }
    };

    /**
     * @param {'region'|'state'} geography
     * @param {SVGSVGElement} svgEl
    */
    function captureClickedGeography(geography, svgEl) {
      if (geography === 'region') {
        if (!svgEl.parentNode.hasAttribute('data-region')) return;
        window.dataLayer.push({
          event: 'regionClicked',
          selectedRegion: undefined,
          selectedState: undefined,
          clickedRegion: svgEl.parentNode.getAttribute('data-region'),
          clickedState: undefined,
        });
      }

      if (geography === 'state') {
        if (!svgEl.parentNode.hasAttribute('data-state')) return;
        window.dataLayer.push({
          event: 'stateClicked',
          selectedRegion: undefined,
          selectedState: undefined,
          clickedRegion: undefined,
          clickedState: svgEl.parentNode.getAttribute('data-state'),
        });
      }
    }

    regionSelect.addEventListener('change', function(ev) {
      captureSelectedGeography('region', ev.target);
    }, false);

    stateSelect.addEventListener('change', function(ev) {
      captureSelectedGeography('state', ev.target);
    }, false);

    regionMap.addEventListener('click', function(ev) {
      captureClickedGeography('region', ev.target);
    }, false);

    stateMap.addEventListener('click', function(ev) {
      captureClickedGeography('state', ev.target);
    }, false);
  })();
</script>
