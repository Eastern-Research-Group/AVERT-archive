<script>
  (function () {
    var calculateBtn = document.querySelector('[data-avert-calculate-impacts-btn]'); // prettier-ignore
    var inputsContainer = document.querySelector("[data-avert-eere-inputs]");
    if (!calculateBtn || !inputsContainer) return;

    /**
     * NOTE: We need to use `getElementsByTagName()` to select the eere inputs,
     * as it returns a live HTMLCollection instead of a static NodeList (that
     * `querySelectorAll()` would have returned). This is necessary because the
     * offshore wind input is conditionally rendered only if the region supports
     * offshore wind...which means when this JavaScript code is added to the
     * page on DOM Ready (as set up in Google Tag Manager), that input element
     * might not yet exist in the DOM.
     */
    var eereInputs = inputsContainer.getElementsByTagName("input");
    var eereSelects = inputsContainer.getElementsByTagName("select");

    function captureEereImpacts() {
      var inputs = {};

      Array.from(eereSelects).forEach(function (select) {
        inputs[select.dataset.avertEereInput] = select.value;
      });

      Array.from(eereInputs).forEach(function (input) {
        inputs[input.dataset.avertEereInput] = input.value;
      });

      window.dataLayer.push({
        event: "eereImpactsCalculated",
        eereImpacts: JSON.stringify(inputs),
      });
    }

    calculateBtn.addEventListener("click", function (ev) {
      captureEereImpacts();
    });

    Array.from(eereInputs).forEach(function (input) {
      input.addEventListener("keypress", function (ev) {
        if (ev.key === "Enter") captureEereImpacts();
      });
    });
  })();
</script>

<script>
  (function () {
    var chartContainers = document.querySelectorAll("[data-avert-chart]");
    if (!chartContainers) return;

    Array.from(chartContainers).forEach(function (chartContainer) {
      chartContainer.addEventListener("mousedown", function (ev) {
        if (ev.target.className !== "highcharts-menu-item") return;

        var chart = ev.target.closest("[data-highcharts-chart]");
        if (!chart) return;

        // EE/RE Profile chart doesn't have title, so set it explicitly
        var titleEl = chart.querySelector(".avert-chart-title");
        var chartTitle = titleEl ? titleEl.innerText : "EE/RE Profile";

        window.dataLayer.push({
          event: "chartExportClicked",
          exportedChartTitle: chartTitle,
          exportedChartAction: ev.target.innerText,
        });
      });
    });
  })();
</script>
